Новый проект детектора транспорта на flask без php
сделан на python3, т.к. в python2 есть проблемы в работе с сокетами

25.01 начали. исследовал возможность запуска тредов. проверил, работает.

26.01 	- (Сделано) импортировать основную логику - бывший main.py, переименовать его в carDetector
	- (Сделано) сделать загрузку полигонов из файла при старте программы	
	- (Сделано) отображать состояния полигонов на web странице в реальном времени красный, зеленый.
	- (Сделано) сделать корректное отображение строки "Режим редактирования"
	- (Сделано) сделать, чтоб желтые уголки полигона пропадали не в режиме редактирования
	- (Сделано) сделать чтоб продолжало работать при выключенном web 
	- (Сделано) доделать и проверить работу камеры в linux 
	- (Сделано) сделать корректную работу кнопки удалить все
	- (Сделано) сделать передачу и работу стрелок и режимов рамки
	- (Сделано) сделать правильную картинку в windows - размер чтоб соответствовал размеру фрейма в web	
	- (Сделано) сделать другой алгоритм поиска направления движения
		(Сделано) - в классе детектор сделал метод, кот-й вычисляет угол наклона медианы по х и у надо его пускать в конструкторе 
			возможно надо выдавать косинус, но надо проверить, может надо и сам угол, 
			чтобы понимать направление вправо или влево, вверх или вниз. начнем с косинуса. дальше будет видно.
		(Сделано) - сделать метод, который будет вычислять движение умножением движения по абсолютным осям х и у на косинус наклона медианы. 
		(Сделано) - в main надо сделать чтобы при переборе по ramki detections если по даному направлению есть движ, то с неким порогом 			срабатывания, 						выдавать сработку.  
		(Сделано) - надо сделать чтобы движ срабатывал по гистерезису. - сработка по одному порогу, отпускание по другому
		(Сделано) - выработать аглоритм для работы в режиме остановка:
			- основная идея: при движе все так-же, как и при режиме проезд, но 
			  в случае с обучением фона - если рамка сработанная по движу и есть сработка по фону то она остается в сработанном положении, до тех пор, пока 
			  на уйдет сработка по фону, даже если уже кончилась сработка по движу. 
	- (Сделано) сделать и проверить работу с концентратором
	- (Сделано) сделать бродкаст искалок узлов - вместо этого сделан сброс в заводские настройки 
	- (Сделано) добавить прогу в автозагрузку linux		
	- (Сделано) сделать страницу передачи настроечных параметров (порог детектирования движения, гистерезис детектирования движения, порог детектирования фона, гистерезис 						детектирования фона)
		- (решено) проблема: числа из таблицы не применяются в программе после изменения в web - надо проверять работу sendSettingsToServer в poly
		- (Сделано) сделать сохранение файла настроек после изменения их в web
	- (Сделано) сделать кнопку отправить запрос в модале на стиле
	- (решено) проблема - не запоминаются настройки детектирования в windows  проблема была из-за кнопки формы типа submit, которая перезагружала страницу. 
	

	- настройки детектора в firefox не сохраняются, в хроме сохраняются.  возможно при обновлении настроек надо блокировать основной поток как для случая обновления рамок. посмотреть.
	
	- 9.03 2 проблемы: кривой адрес хаба, не сохраняются настройки детектора. Работаем с настройками. 
		выключаем передачу постов на хаб, временно, а то заоб спамить в консоль. потом не забыть включить стр 357app метка ctrl 6
	- проблема - данные на концентратор отсылаются на один и тот-же IP - IP не меняется при изменении его на сайте
			 

	

	

	
	- сделать прореживание точек в детекторе движения. - должно улучшиться время цикла.- вопрос - так-ли это? проверить выключив временно подсчет среднего. 
	


	
	- сделать при удалении полигона, чтоб его номер оставался (не понятно как тогда быть если есть полигоны 2,3,4 и надо создать 5. прога его будет нумеровать 1 или 5?)
	- сделать диагностику ответа от хаба на web странице при нажатии D.

	- сделать чтобы полигон нельзя было вращать - чтобы правые углы нельзя было затащить левее левых, а верхние опустить ниже нижних ( сделать только для одного или 2-х углов, а то не все варианты рамки можно будет нарисовать
	- сделать другой фивикон
	- поправить стиль модальной таблицы всей - перейти на bootstrap?
	- сделать кнопку помощь и справку

проблема: сбивается запуск после пропадания питания. гаснет камера через 5 спе работы (подумать как отладить)

проблема: не применяетсяя hub IP после изменения...

проблема: после первой перезагрузки после смены IP в дефолт кнопкой. вылетает после нескольких секунд работы ( гаснет индикатор камеры)

time.sleep(0.02) надо поэкспериментировать !!!!!!!!!!! стр 436 app.py убавить надо

Проблема: если нажать в web редактировать и сразу сохранить, не редактируя полигоны, грузятся тестовые рамки... при проверке не воспроизвелось....


(Решено)проблема:
	пусть есть 2 питон файла, рабочий 1, в него импортируется 2-й. переменная из второго модифицируется в первом. что будет с ней при выводе ее во втором. 
	проверяем. на тесте. 
	Результаты теста: перекрестные ссылки (1 на 2 и 2 на 1) запрещены. можно только один импорт. например 1 в 2. Тогда переменная в 2 которой там нет, окажется неопределенной.
	Вопрос возник из-за путей. в 2-[] файлах. придется пути писать в первом и передавать их в функции в качестве аргументов во втором. 
	глобальный итог: Надо писать чистые классы, работоспособные после переноса и модификации программы. и не пользоваться глобальными переменными. 
	проблема снята.

(Решено)проблема:
	модуль Camera() отдает битовые последовательности. в обработке нужны обычные картинки. есть 2 пути решения: 
	- можно 2 штуки сразу в кортеже отдавать из Camera() - бит последовательность и картинку. 
	- можно отдавать картинку, и только потом ее уже в app переводить в последовательность и отдавать в web для индикации. 
	- решено дописыванием нового метода с выдачей в нужном формате

(Заговнокодено)проблема:
	прога вылетает при закрытии web страницы -  картинка в распознавалке оказывается пустой. проблема была в вызове деструктора, решение - пока деструктор закоментил. 

(Решено)Проблема: 
	модуль PIcamera если делать 2 треда, то в одном из них картинка оказывается None. Возможный выход - только один тред и последовательная конвертация из формата
	для web в формат для cv2. Лучше бы конечно наоборот - сначала в cv2 и из него уже в web stream. надо читать про stream. первый вариант прокатил. время цикла заметно увеличилось 
	с 45 мс до 75-100 второй вариант много лучше, т.к. не происходит кодировани и декодирования. Второй вариант тоже прокатил, он лучше первого, т.к. происходит только кодирование в 		jpeg и только когда работает web. доп задержек нет. 		



проблема не относщаяся к DT smartVision но важная для камер Питера - при кодировании потока для web прога рассыпается. решение - попробовать кодирование сунуть в отдельный тред. 
	